---
title: 2020-09-05-tf&&torchçŸ¥è¯†ç‚¹æ‚
mathjax: true
date: 2020-09-05 19:56:22
tags:
top: 80
categories:
description: è®°å½•æ‚ä¹±çš„çŸ¥è¯†ç‚¹ï¼ŒæŒç»­æ›´æ–°
---



## ðŸš€others

### pythonçš„einops  rearrange()å‡½æ•°

ä¾‹å­ï¼š

å‡è®¾æˆ‘æœ‰ä¸€ä¸ª3-Dæ•°ç»„ï¼š

```
[[[0,1,2],
  [0,1,2],
  [0,1,2]],

 [[3,4,5],
  [3,4,5],
  [3,4,5]]]
```

æˆ‘æƒ³æŒ‰åˆ—é‡æ–°æŽ’åˆ—ï¼š

```
[[0,1,2,3,4,5],
 [0,1,2,3,4,5],
 [0,1,2,3,4,5]]
```



ä½¿ç”¨einopsï¼š

```py
einops.rearrange(a, 'x y z -> y (x z) ')
```

å¹¶ä¸”æˆ‘å»ºè®®æ ¹æ®ä¸Šä¸‹æ–‡ï¼ˆä¾‹å¦‚æ—¶é—´ï¼Œé«˜åº¦ç­‰ï¼‰ä¸ºè½´æŒ‡å®šæœ‰æ„ä¹‰çš„åç§°ï¼ˆè€Œä¸æ˜¯xyzï¼‰ã€‚ è¿™å°†ä½¿æ‚¨æ˜“äºŽç†è§£ä»£ç çš„ä½œç”¨

```
In : einops.rearrange(a, 'x y z -> y (x z) ')
Out:
array([[0, 1, 2, 3, 4, 5],
       [0, 1, 2, 3, 4, 5],
       [0, 1, 2, 3, 4, 5]])
```



### Epochã€Iterationã€Batch_size

> [https://blog.csdn.net/program_developer/article/details/78597738](https://blog.csdn.net/program_developer/article/details/78597738)



## ðŸš€tensorflow

### tf.tile()ç”¨æ³•

> [https://blog.csdn.net/tsyccnh/article/details/82459859](https://blog.csdn.net/tsyccnh/article/details/82459859)



### Dataset API å’Œ Iterator

> Dataset API å’Œ Iterator
>
> [https://blog.csdn.net/briblue/article/details/80962728](https://blog.csdn.net/briblue/article/details/80962728)
>
> TensorFlowä¸­çš„Dataset API
>
> [https://blog.csdn.net/dqcfkyqdxym3f8rb0/article/details/79342369](https://blog.csdn.net/dqcfkyqdxym3f8rb0/article/details/79342369)
>
> TensorFlow dataæ¨¡å—è¯¦è§£
>
> [https://www.weaf.top/posts/cd5ba0c4/](https://www.weaf.top/posts/cd5ba0c4/)
>
> ä½¿ç”¨Tensorflowçš„DataSetå’ŒIteratorè¯»å–æ•°æ®
>
> [https://www.jianshu.com/p/bcff8a99b15b](https://www.jianshu.com/p/bcff8a99b15b)
>
> tensorflowæ•°æ®è¯»å–æœºåˆ¶ï¼ˆé™„ä»£ç ï¼‰
>
> [https://zhuanlan.zhihu.com/p/27238630](https://zhuanlan.zhihu.com/p/27238630)
>
> Dataset APIå…¥é—¨æ•™ç¨‹
>
> [https://zhuanlan.zhihu.com/p/30751039](https://zhuanlan.zhihu.com/p/30751039)
>
> Dataset.from_generator
>
> [https://blog.csdn.net/foreseerwang/article/details/80572182](https://blog.csdn.net/foreseerwang/article/details/80572182)



çœ‹ä¸ªç®€å•çš„ç¤ºä¾‹ï¼š

```
#åˆ›å»ºä¸€ä¸ªDatasetå¯¹è±¡
dataset = tf.data.Dataset.from_tensor_slices([1,2,3,4,5,6,7,8,9])

#åˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨
iterator = dataset.make_one_shot_iterator()

#get_next()å‡½æ•°å¯ä»¥å¸®åŠ©æˆ‘ä»¬ä»Žè¿­ä»£å™¨ä¸­èŽ·å–å…ƒç´ 
element = iterator.get_next()

#éåŽ†è¿­ä»£å™¨ï¼ŒèŽ·å–æ‰€æœ‰å…ƒç´ 
with tf.Session() as sess:
   for i in range(9):
       print(sess.run(element))
```

ä»¥ä¸Šæ‰“å°ç»“æžœä¸ºï¼š1 2 3 4 5 6 7 8 9

from_generator

åˆ›å»ºDatasetç”±å…¶ç”Ÿæˆå…ƒç´ çš„å…ƒç´ generatorã€‚

å‡½æ•°å½¢å¼ï¼šfrom_generator(generator,output_types,output_shapes=None,args=None)

å‚æ•°generator:ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ï¼Œå®ƒè¿”å›žæ”¯æŒè¯¥iter()åè®®çš„å¯¹è±¡ ã€‚å¦‚æžœargsæœªæŒ‡å®šï¼Œgeneratoråˆ™ä¸å¾—å‚æ•°; å¦åˆ™å®ƒå¿…é¡»é‡‡å–ä¸Žæœ‰å€¼ä¸€æ ·å¤šçš„å‚æ•°argsã€‚
å‚æ•°output_typesï¼štf.DTypeå¯¹åº”äºŽç”±å…ƒç´ ç”Ÿæˆçš„å…ƒç´ çš„æ¯ä¸ªç»„ä»¶çš„å¯¹è±¡çš„åµŒå¥—ç»“æž„generatorã€‚
å‚æ•°output_shapes:tf.TensorShape å¯¹åº”äºŽç”±å…ƒç´ ç”Ÿæˆçš„å…ƒç´ çš„æ¯ä¸ªç»„ä»¶çš„å¯¹è±¡ çš„åµŒå¥—ç»“æž„generator
å‚æ•°args:tf.Tensorå°†è¢«è®¡ç®—å¹¶å°†generatorä½œä¸ºNumPyæ•°ç»„å‚æ•°ä¼ é€’çš„å¯¹è±¡å…ƒç»„ã€‚

å…·ä½“ä¾‹å­

```
#å®šä¹‰ä¸€ä¸ªç”Ÿæˆå™¨
def data_generator():
    dataset = np.array(range(9))
    for i in dataset:
        yield i

#æŽ¥æ”¶ç”Ÿæˆå™¨ï¼Œå¹¶ç”Ÿäº§datasetæ•°æ®ç»“æž„
dataset = tf.data.Dataset.from_generator(data_generator, (tf.int32))

iterator = concat_dataset.make_one_shot_iterator()

element = iterator.get_next()

with tf.Session() as sess:
   for i in range(3):
       print(sess.run(element))
```

ä»¥ä¸Šä»£ç è¿è¡Œç»“æžœï¼š0 1 2



### tf strip() å’Œ  split() 

> [https://blog.csdn.net/hjxu2016/article/details/78676859](https://blog.csdn.net/hjxu2016/article/details/78676859)

### Summaryç”¨æ³• -tensorboradå¯è§†åŒ–

> [https://www.cnblogs.com/lyc-seu/p/8647792.html](https://www.cnblogs.com/lyc-seu/p/8647792.html)

### math.ceil() 

> [https://www.runoob.com/python/func-number-ceil.html](https://www.runoob.com/python/func-number-ceil.html)

### .format() æ ¼å¼åŒ–å‡½æ•°

> [https://www.runoob.com/python/att-string-format.html](https://www.runoob.com/python/att-string-format.html)

### tf.shape(A) å’Œ A.get_shape().as_list() å’Œ tf.split()

> [https://www.itread01.com/content/1544436557.html](https://www.itread01.com/content/1544436557.html)
>
> [https://blog.csdn.net/xc_zhou/article/details/85632109](https://blog.csdn.net/xc_zhou/article/details/85632109)

- tf.shape(A) # ç²å–å¼µé‡Aï¼ˆé™£åˆ—ï¼Œlist, tensorå¼µé‡ï¼‰çš„å¤§å°ï¼Œè¿”å›žçš„æ˜¯ä¸€å€‹list
- x.get_shape()ï¼Œåªæœ‰**tensor**æ‰å¯ä»¥ä½¿ç”¨é€™ç¨®æ–¹æ³•ï¼Œè¿”å›žçš„æ˜¯ä¸€å€‹å…ƒçµ„
- tf.split(dimension, num_split, input)ï¼šdimensionçš„æ„æ€å°±æ˜¯è¼¸å…¥å¼µé‡çš„å“ªä¸€å€‹ç¶­åº¦ï¼Œå¦‚æžœæ˜¯0å°±è¡¨ç¤ºå°ç¬¬0ç¶­åº¦é€²è¡Œåˆ‡å‰²ã€‚num_splitå°±æ˜¯åˆ‡å‰²çš„æ•¸é‡ï¼Œå¦‚æžœæ˜¯2å°±è¡¨ç¤ºè¼¸å…¥å¼µé‡è¢«åˆ‡æˆ2ä»½ï¼Œæ¯ä¸€ä»½æ˜¯ä¸€å€‹åˆ—è¡¨ã€‚

### tf.range()

```python
w=tf.range(3)
print (sess.run(w))#è¾“å‡º[0 1 2]
```

### os.pathï¼ˆï¼‰



| æ–¹æ³•                                | è¯´æ˜Ž                                                         |
| :---------------------------------- | :----------------------------------------------------------- |
| os.path.abspath(path)               | è¿”å›žç»å¯¹è·¯å¾„                                                 |
| os.path.basename(path)              | è¿”å›žæ–‡ä»¶å                                                   |
| os.path.join(path1[, path2[, ...]]) | æŠŠç›®å½•å’Œæ–‡ä»¶ååˆæˆä¸€ä¸ªè·¯å¾„                                   |
| os.path.dirname(path)               | è¿”å›žæ–‡ä»¶è·¯å¾„                                                 |
| os.path.exists(path)                | å¦‚æžœè·¯å¾„ path å­˜åœ¨ï¼Œè¿”å›ž Trueï¼›å¦‚æžœè·¯å¾„ path ä¸å­˜åœ¨ï¼Œè¿”å›ž Falseã€‚ |
| os.path.split(path)                 | æŠŠè·¯å¾„åˆ†å‰²æˆ dirname å’Œ basenameï¼Œè¿”å›žä¸€ä¸ªå…ƒç»„               |



> [https://www.runoob.com/python/python-os-path.html](https://www.runoob.com/python/python-os-path.html)

### embedding_lookup()

tf.nn.embedding_lookup()å°±æ˜¯æ ¹æ®input_idsä¸­çš„idï¼Œå¯»æ‰¾embeddingsä¸­çš„ç¬¬idè¡Œã€‚æ¯”å¦‚input_ids=[1,3,5]ï¼Œåˆ™æ‰¾å‡ºembeddingsä¸­ç¬¬1ï¼Œ3ï¼Œ5è¡Œï¼Œç»„æˆä¸€ä¸ªtensorè¿”å›žã€‚

> [https://www.jianshu.com/p/7bb87873f89e](https://www.jianshu.com/p/7bb87873f89e)
>
> [https://www.zhihu.com/question/52250059](https://www.zhihu.com/question/52250059)



### æ¨¡åž‹ä¿å­˜å’ŒåŠ è½½

Saverçš„ä½œç”¨æ˜¯å°†æˆ‘ä»¬è®­ç»ƒå¥½çš„æ¨¡åž‹çš„å‚æ•°ä¿å­˜ä¸‹æ¥ï¼Œä»¥ä¾¿ä¸‹ä¸€æ¬¡ç»§ç»­ç”¨äºŽè®­ç»ƒæˆ–æµ‹è¯•ï¼›Restoreçš„ç”¨æ³•æ˜¯å°†è®­ç»ƒå¥½çš„å‚æ•°æå–å‡ºæ¥ã€‚ 

1.Saverç±»è®­ç»ƒå®ŒåŽï¼Œæ˜¯ä»¥**checkpointsæ–‡ä»¶å½¢å¼**ä¿å­˜ã€‚æå–çš„æ—¶å€™ä¹Ÿæ˜¯ä»Žcheckpointsæ–‡ä»¶ä¸­æ¢å¤å˜é‡ã€‚ Checkpointsæ–‡ä»¶æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå®ƒæŠŠå˜é‡åæ˜ å°„åˆ°å¯¹åº”çš„tensorå€¼ ã€‚ 

2.é€šè¿‡forå¾ªçŽ¯ï¼ŒSaverç±»å¯ä»¥è‡ªåŠ¨çš„ç”Ÿæˆcheckpointæ–‡ä»¶ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥**ä¿å­˜å¤šä¸ªè®­ç»ƒç»“æžœ**ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä¿å­˜æ¯ä¸€æ­¥è®­ç»ƒçš„ç»“æžœã€‚ä½†æ˜¯ä¸ºäº†é¿å…å¡«æ»¡æ•´ä¸ªç£ç›˜ï¼Œ**Saverå¯ä»¥è‡ªåŠ¨çš„ç®¡ç†Checkpointsæ–‡ä»¶**ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šä¿å­˜æœ€è¿‘çš„Nä¸ªCheckpointsæ–‡ä»¶ã€‚



### Tensorflowæ¨¡åž‹ä¿å­˜å’Œè¯»å–tf.train.Saver

ç›®æ ‡ï¼šè®­ç»ƒç½‘ç»œåŽæƒ³ä¿å­˜è®­ç»ƒå¥½çš„æ¨¡åž‹ï¼Œä»¥åŠåœ¨ç¨‹åºä¸­è¯»å–ä»¥ä¿å­˜çš„è®­ç»ƒå¥½çš„æ¨¡åž‹ã€‚

é¦–å…ˆï¼Œä¿å­˜å’Œæ¢å¤éƒ½éœ€è¦å®žä¾‹åŒ–ä¸€ä¸ª tf.train.Saverã€‚

>  saver = tf.train.Saver() 

ç„¶åŽï¼Œåœ¨è®­ç»ƒå¾ªçŽ¯ä¸­ï¼Œå®šæœŸè°ƒç”¨ saver.save() æ–¹æ³•ï¼Œå‘æ–‡ä»¶å¤¹ä¸­å†™å…¥åŒ…å«äº†å½“å‰æ¨¡åž‹ä¸­æ‰€æœ‰å¯è®­ç»ƒå˜é‡çš„ checkpoint æ–‡ä»¶ã€‚

>  saver.save(sess, save_path, global_step=step) 

ä¹‹åŽï¼Œå°±å¯ä»¥ä½¿ç”¨ saver.restore() æ–¹æ³•ï¼Œé‡è½½æ¨¡åž‹çš„å‚æ•°ï¼Œç»§ç»­è®­ç»ƒæˆ–ç”¨äºŽæµ‹è¯•æ•°æ®ã€‚

>  saver.restore(sess, save_path) 

æ¨¡åž‹çš„æ¢å¤ç”¨çš„æ˜¯restore()å‡½æ•°ï¼Œå®ƒéœ€è¦ä¸¤ä¸ªå‚æ•°restore(sess, save_path)ï¼Œsave_pathæŒ‡çš„æ˜¯ä¿å­˜çš„æ¨¡åž‹è·¯å¾„ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`tf.train.latest_checkpointï¼ˆï¼‰`æ¥è‡ªåŠ¨èŽ·å–æœ€åŽä¸€æ¬¡ä¿å­˜çš„æ¨¡åž‹ã€‚å¦‚ï¼š

```javascript
model_file=tf.train.latest_checkpoint('ckpt/')
saver.restore(sess,model_file)
```

ä¸€æ¬¡ saver.save() åŽå¯ä»¥åœ¨æ–‡ä»¶å¤¹ä¸­çœ‹åˆ°æ–°å¢žçš„å››ä¸ªæ–‡ä»¶ï¼Œ 

![image-20200929102459806](https://i.loli.net/2020/09/29/kRYmSZn8BbwJ4NK.png)

 å®žé™…ä¸Šæ¯è°ƒç”¨ä¸€æ¬¡ä¿å­˜æ“ä½œä¼šåˆ›å»ºåŽ3ä¸ªæ•°æ®æ–‡ä»¶å¹¶åˆ›å»ºä¸€ä¸ªæ£€æŸ¥ç‚¹ï¼ˆcheckpointï¼‰æ–‡ä»¶ï¼Œç®€å•ç†è§£å°±æ˜¯æƒé‡ç­‰å‚æ•°è¢«ä¿å­˜åˆ° .ckpt.data æ–‡ä»¶ä¸­ï¼Œä»¥å­—å…¸çš„å½¢å¼ï¼›å›¾å’Œå…ƒæ•°æ®è¢«ä¿å­˜åˆ° .ckpt.meta æ–‡ä»¶ä¸­ï¼Œå¯ä»¥è¢« tf.train.import_meta_graph åŠ è½½åˆ°å½“å‰é»˜è®¤çš„å›¾ã€‚

saver.restore()æ—¶å¡«çš„æ–‡ä»¶åï¼Œå› ä¸ºåœ¨saver.saveçš„æ—¶å€™ï¼Œæ¯ä¸ªcheckpointä¼šä¿å­˜ä¸‰ä¸ªæ–‡ä»¶ï¼Œå¦‚ `my-model-10000.meta`, `my-model-10000.index`, `my-model-10000.data-00000-of-00001`

åœ¨`import_meta_graph`æ—¶å¡«çš„å°±æ˜¯`meta`æ–‡ä»¶åï¼Œæˆ‘ä»¬çŸ¥é“æƒå€¼éƒ½ä¿å­˜åœ¨my-model-10000.data-00000-of-00001è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œä½†æ˜¯å¦‚æžœåœ¨restoreæ–¹æ³•ä¸­å¡«è¿™ä¸ªæ–‡ä»¶åï¼Œå°±ä¼šæŠ¥é”™ï¼Œåº”è¯¥å¡«çš„æ˜¯å‰ç¼€ï¼Œè¿™ä¸ªå‰ç¼€å¯ä»¥ä½¿ç”¨`tf.train.latest_checkpoint(checkpoint_dir)`è¿™ä¸ªæ–¹æ³•èŽ·å–ã€‚

ä¸‹é¢ä»£ç æ˜¯ç®€å•çš„ä¿å­˜å’Œè¯»å–æ¨¡åž‹ï¼šï¼ˆä¸åŒ…æ‹¬åŠ è½½å›¾æ•°æ®ï¼‰

```javascript
import tensorflow as tf
import numpy as np
import os
 
#ç”¨numpyäº§ç”Ÿæ•°æ®
x_data = np.linspace(-1,1,300)[:, np.newaxis] #è½¬ç½®
noise = np.random.normal(0,0.05, x_data.shape)
y_data = np.square(x_data)-0.5+noise
 
#è¾“å…¥å±‚
x_ph = tf.placeholder(tf.float32, [None, 1])
y_ph = tf.placeholder(tf.float32, [None, 1])
 
#éšè—å±‚
w1 = tf.Variable(tf.random_normal([1,10]))
b1 = tf.Variable(tf.zeros([1,10])+0.1)
wx_plus_b1 = tf.matmul(x_ph, w1) + b1
hidden = tf.nn.relu(wx_plus_b1)
 
#è¾“å‡ºå±‚
w2 = tf.Variable(tf.random_normal([10,1]))
b2 = tf.Variable(tf.zeros([1,1])+0.1)
wx_plus_b2 = tf.matmul(hidden, w2) + b2
y = wx_plus_b2
 
#æŸå¤±
loss = tf.reduce_mean(tf.reduce_sum(tf.square(y_ph-y),reduction_indices=[1]))
train_op = tf.train.GradientDescentOptimizer(0.1).minimize(loss)
 
#ä¿å­˜æ¨¡åž‹å¯¹è±¡saver
saver = tf.train.Saver()
 
#åˆ¤æ–­æ¨¡åž‹ä¿å­˜è·¯å¾„æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨å°±åˆ›å»º
if not os.path.exists('tmp/'):
    os.mkdir('tmp/')
 
#åˆå§‹åŒ–
with tf.Session() as sess:
    if os.path.exists('tmp/checkpoint'):         #åˆ¤æ–­æ¨¡åž‹æ˜¯å¦å­˜åœ¨
        saver.restore(sess, 'tmp/model.ckpt')    #å­˜åœ¨å°±ä»Žæ¨¡åž‹ä¸­æ¢å¤å˜é‡
    else:
        init = tf.global_variables_initializer() #ä¸å­˜åœ¨å°±åˆå§‹åŒ–å˜é‡
        sess.run(init)
 
    for i in range(1000):
        _,loss_value = sess.run([train_op,loss], feed_dict={x_ph:x_data, y_ph:y_data})
        if(i%50==0):
            save_path = saver.save(sess, 'tmp/model.ckpt')
            print("è¿­ä»£æ¬¡æ•°ï¼š%d , è®­ç»ƒæŸå¤±ï¼š%s"%(i, loss_value))
```

æ³¨ï¼š

- saver çš„æ“ä½œå¿…é¡»åœ¨ sess å»ºç«‹åŽè¿›è¡Œã€‚
- model.ckpt å¿…é¡»å­˜åœ¨ç»™å®šæ–‡ä»¶å¤¹ä¸­ï¼Œâ€˜tmp/model.ckptâ€™ è¿™é‡Œè‡³å°‘è¦æœ‰ä¸€å±‚æ–‡ä»¶å¤¹ï¼Œå¦åˆ™æ— æ³•ä¿å­˜ã€‚
- æ¢å¤æ¨¡åž‹æ—¶åŒä¿å­˜æ—¶ä¸€æ ·ï¼Œæ˜¯ â€˜tmp/model.ckptâ€™ï¼Œå’Œé‚£3ä¸ªæ–‡ä»¶åéƒ½ä¸ä¸€æ ·ã€‚



å¦‚æžœä¸ç”¨`tf.train.latest_checkpointï¼ˆï¼‰`æ¥è‡ªåŠ¨èŽ·å–æœ€åŽä¸€æ¬¡ä¿å­˜çš„æ¨¡åž‹ï¼Œåˆ™æ€Žä¹ˆåšå‘¢ï¼Ÿ



> [https://www.jianshu.com/p/7ebee4d10e49](https://www.jianshu.com/p/7ebee4d10e49)
>
> [https://blog.csdn.net/mylove0414/article/details/55097486](https://blog.csdn.net/mylove0414/article/details/55097486)
>



### Saverä¸­çš„max_to_keep å‚æ•°



### kerasä¸­çš„TimeDistributedå‡½æ•°



> [https://blog.csdn.net/u012193416/article/details/79477220](https://blog.csdn.net/u012193416/article/details/79477220)
>
> [https://keras.io/zh/layers/wrappers/](https://keras.io/zh/layers/wrappers/)
>
> [https://blog.csdn.net/zh_JNU/article/details/85160379](https://blog.csdn.net/zh_JNU/article/details/85160379)
>
> [https://www.cnblogs.com/CheeseZH/p/13408658.html](https://www.cnblogs.com/CheeseZH/p/13408658.html)



### tf.concat()è¯¦è§£

```python
tf.concat([tensor1, tensor2, tensor3,...], axis)
# axis=0     ä»£è¡¨åœ¨ç¬¬0ä¸ªç»´åº¦æ‹¼æŽ¥
# axis=1     ä»£è¡¨åœ¨ç¬¬1ä¸ªç»´åº¦æ‹¼æŽ¥ 
#axis=-1	 ä»£è¡¨å€’æ•°ç¬¬ä¸€ä¸ªç»´åº¦
```



> [https://blog.csdn.net/leviopku/article/details/82380118](https://blog.csdn.net/leviopku/article/details/82380118)







### shape

numpyæ•°æ®çš„å½¢çŠ¶ï¼š

```python
 x.shape()
```



list æ•°æ®çš„å½¢çŠ¶ï¼š

```python
np.shape(x)
```



**æ³¨ï¼š**å¦‚æžœå†™`x.shape()` , åˆ™ä¼šæŠ¥é”™`ValueError: invalid literal for int() with base 10` 



torsorå½¢çŠ¶ï¼š

```python
x.get_shape()
```

### keras çš„ fitå‡½æ•°

fitä¸­ä»¥call()æ–¹æ³•çš„å½¢å¼æ¥run session

> [https://blog.csdn.net/u012526436/article/details/102488164](https://blog.csdn.net/u012526436/article/details/102488164)



### Model ç±»ç»§æ‰¿



**å¯ä»¥é€šè¿‡ç»§æ‰¿ `Model` ç±»å¹¶åœ¨ `call` æ–¹æ³•ä¸­å®žçŽ°ä½ è‡ªå·±çš„å‰å‘ä¼ æ’­ï¼Œä»¥åˆ›å»ºä½ è‡ªå·±çš„å®Œå…¨å®šåˆ¶åŒ–çš„æ¨¡åž‹ï¼Œ**ï¼ˆ`Model` ç±»ç»§æ‰¿ API å¼•å…¥äºŽ Keras 2.2.0ï¼‰ã€‚

è¿™é‡Œæ˜¯ä¸€ä¸ªç”¨ `Model` ç±»ç»§æ‰¿å†™çš„ç®€å•çš„å¤šå±‚æ„ŸçŸ¥å™¨çš„ä¾‹å­ï¼š

```python
import keras

class SimpleMLP(keras.Model):

    def __init__(self, use_bn=False, use_dp=False, num_classes=10):
        super(SimpleMLP, self).__init__(name='mlp')
        self.use_bn = use_bn
        self.use_dp = use_dp
        self.num_classes = num_classes

        self.dense1 = keras.layers.Dense(32, activation='relu')
        self.dense2 = keras.layers.Dense(num_classes, activation='softmax')
        if self.use_dp:
            self.dp = keras.layers.Dropout(0.5)
        if self.use_bn:
            self.bn = keras.layers.BatchNormalization(axis=-1)

    def call(self, inputs):
        x = self.dense1(inputs)
        if self.use_dp:
            x = self.dp(x)
        if self.use_bn:
            x = self.bn(x)
        return self.dense2(x)

model = SimpleMLP()
model.compile(...)
model.fit(...)
```

ç½‘ç»œå±‚å®šä¹‰åœ¨ `__init__(self, ...)` ä¸­ï¼Œå‰å‘ä¼ æ’­åœ¨ `call(self, inputs)` ä¸­æŒ‡å®šã€‚åœ¨ `call` ä¸­ï¼Œä½ å¯ä»¥æŒ‡å®šè‡ªå®šä¹‰çš„æŸå¤±å‡½æ•°ï¼Œé€šè¿‡è°ƒç”¨ `self.add_loss(loss_tensor)` ï¼ˆå°±åƒä½ åœ¨è‡ªå®šä¹‰å±‚ä¸­ä¸€æ ·ï¼‰ã€‚

åœ¨ç±»ç»§æ‰¿æ¨¡åž‹ä¸­ï¼Œæ¨¡åž‹çš„æ‹“æ‰‘ç»“æž„æ˜¯ç”± Python ä»£ç å®šä¹‰çš„ï¼ˆè€Œä¸æ˜¯ç½‘ç»œå±‚çš„é™æ€å›¾ï¼‰ã€‚è¿™æ„å‘³ç€è¯¥æ¨¡åž‹çš„æ‹“æ‰‘ç»“æž„ä¸èƒ½è¢«æ£€æŸ¥æˆ–åºåˆ—åŒ–ã€‚å› æ­¤ï¼Œä»¥ä¸‹æ–¹æ³•å’Œå±žæ€§**ä¸é€‚ç”¨äºŽç±»ç»§æ‰¿æ¨¡åž‹**ï¼š

- `model.inputs` å’Œ `model.outputs`ã€‚
- `model.to_yaml()` å’Œ `model.to_json()`ã€‚
- `model.get_config()` å’Œ `model.save()`ã€‚

**å…³é”®ç‚¹**ï¼šä¸ºæ¯ä¸ªä»»åŠ¡ä½¿ç”¨æ­£ç¡®çš„ APIã€‚`Model` ç±»ç»§æ‰¿ API å¯ä»¥ä¸ºå®žçŽ°å¤æ‚æ¨¡åž‹æä¾›æ›´å¤§çš„çµæ´»æ€§ï¼Œä½†å®ƒéœ€è¦ä»˜å‡ºä»£ä»·ï¼ˆæ¯”å¦‚ç¼ºå¤±çš„ç‰¹æ€§ï¼‰ï¼šå®ƒæ›´å†—é•¿ï¼Œæ›´å¤æ‚ï¼Œå¹¶ä¸”æœ‰æ›´å¤šçš„ç”¨æˆ·é”™è¯¯æœºä¼šã€‚å¦‚æžœå¯èƒ½çš„è¯ï¼Œå°½å¯èƒ½ä½¿ç”¨å‡½æ•°å¼ APIï¼Œè¿™å¯¹ç”¨æˆ·æ›´å‹å¥½ã€‚



> [https://blog.csdn.net/qq_27825451/article/details/90517036](https://blog.csdn.net/qq_27825451/article/details/90517036)



### å…³äºŽtensorflowçš„sessionã€tensorã€shapeç­‰åŸºç¡€çŸ¥è¯†ï¼ˆæ•´ç†ï¼‰

åœ¨tensorflowç¨‹åºä¸­ï¼Œtensoråªæ˜¯å ä½ç¬¦ï¼Œåœ¨ä¼šè¯å±‚æ²¡æœ‰runå‡ºtensorçš„å€¼ä¹‹å‰ï¼Œæˆ‘ä»¬æ˜¯æ— æ³•èŽ·çŸ¥tensorçš„å€¼çš„

> [https://blog.csdn.net/jiongnima/article/details/78524551](https://blog.csdn.net/jiongnima/article/details/78524551)
>
> [https://www.tensorflow.org/guide/tensor?hl=zh-cn](https://www.tensorflow.org/guide/tensor?hl=zh-cn)
>
> [https://www.jianshu.com/p/75a903a44cf2](https://www.jianshu.com/p/75a903a44cf2)



### tf.layers.flatten

åœ¨ä¿ç•™ç¬¬0è½´çš„æƒ…å†µä¸‹å¯¹è¾“å…¥çš„å¼ é‡è¿›è¡ŒFlatten(æ‰å¹³åŒ–)

ä»£ç ç¤ºä¾‹ï¼š

```python
x=tf.placeholder(shape=(None,4,4),dtype='float32')

y=tf.layers.flatten(x)

print(y)
```

è¾“å‡ºï¼š å°†åŽä¸¤ç»´è¿›è¡Œåˆå¹¶

```
Tensor("flatten/Reshape:0", shape=(?, 16), dtype=float32)
```



### tf.layers.dense

å…¨è¿žæŽ¥å±‚ ï¼Œç›¸å½“äºŽæ·»åŠ ä¸€ä¸ªå±‚ã€‚åª**æ”¹å˜è¾“å…¥çš„æœ€åŽä¸€ç»´**



### python - Tensorflowä¸­ Noneï¼Œ-1å’Œï¼Ÿä¹‹é—´çš„åŒºåˆ«

`None`è¡¨ç¤ºæœªæŒ‡å®šçš„ç»´åº¦ã€‚å› æ­¤ï¼Œå¦‚æžœæ‚¨å®šä¹‰äº†ä¸€ä¸ªå ä½ç¬¦ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨`None`æ¥è¡¨ç¤ºâ€œè¿™ä¸ªç»´åº¦å¯ä»¥æœ‰ä»»ä½•å¤§å°â€ã€‚
å ä½ç¬¦å¯ä»¥æœ‰å¤šä¸ª`None`ç»´åº¦è¿™ä»…ä»…æ„å‘³ç€å¤šä¸ªç»´åº¦å¯ä»¥æ˜¯ä¸åŒçš„å¤§å°ç”šè‡³æ•´ä¸ªå½¢çŠ¶éƒ½å¯ä»¥`None`æ¥æŒ‡å®šæœªçŸ¥çš„ç»´æ•°ã€‚
`-1`æ˜¯TensorFlowçš„ä¸€æ¡æŒ‡ä»¤ï¼Œç”¨äºŽè‡ªè¡ŒæŽ¨æ–­ç»´åº¦çš„å¤§å°ã€‚åœ¨`tf.reshape(input, [-1, input_size])`ä¸­ï¼Œè¿™æ„å‘³ç€â€œé‡å¡‘å®ƒï¼Œä½¿ç¬¬äºŒä¸ªç»´åº¦`input_size`ï¼Œç¬¬ä¸€ä¸ªç»´åº¦æ˜¯åŒ¹é…å…ƒç´ æ€»æ•°æ‰€éœ€çš„ä»»ä½•å†…å®¹â€ã€‚
è¿™å¹¶ä¸ä¸€å®šæ„å‘³ç€ç»´æ•°æ˜¯æœªçŸ¥çš„ï¼Œå› ä¸ºå¯¹äºŽ`None`å¦‚æžœè¾“å…¥å¼ é‡çš„å·²çŸ¥å¤§å°ä¸º10ä¸ªå…ƒç´ ï¼Œå¹¶ä¸”å°†å…¶é‡å¡‘ä¸º`[-1, 2]`ï¼Œåˆ™å¼ é‡æµèƒ½å¤ŸæŽ¨æ–­å‡ºå®Œæ•´çš„å½¢çŠ¶`[5, 2]`ã€‚
`-1`çº¯ç²¹æ˜¯ä¸ºäº†æ–¹ä¾¿ã€‚ä½ å¯ä»¥æŠŠå½¢çŠ¶å†™ä¸‹æ¥ï¼Œè€Œä¸æ˜¯è®©TensorflowæŽ¨æ–­å‡ºæ¥`None`å¦ä¸€æ–¹é¢ï¼Œå¯¹äºŽæŽ¥å—å¯å˜å¤§å°å¼ é‡æ˜¯å¿…è¦çš„ã€‚
ä¸€ä¸ªå½¢çŠ¶ä¸­åªèƒ½æœ‰ä¸€ä¸ª`-1`ã€‚å¤šä¸ªæ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå› ä¸ºä¸å¯èƒ½æŽ¨æ–­å‡ºå½¢çŠ¶ã€‚ä¾‹å¦‚ï¼Œå¦‚æžœä¸€ä¸ªå¼ é‡ä¸­æœ‰12ä¸ªå…ƒç´ ï¼Œåˆ™æœªå®šä¹‰å°†å…¶é‡å¡‘ä¸º`[-1, -1, 2]`â€”â€”æˆ‘ä»¬æ˜¯å¦åº”è¯¥è¿™æ ·åšï¼Ÿ`[3, 2, 2]`ï¼Ÿ`[2, 3, 2]`ï¼Ÿâ€¦
æœ€åŽï¼Œé—®å·æ­£æ˜¯tensorflowåœ¨æ‰“å°å¼ é‡å’Œ/æˆ–å…¶å½¢çŠ¶æ—¶ç”¨æ¥æ ‡è®°â€œæœªçŸ¥â€ç»´åº¦çš„å†…å®¹ã€‚æ‚¨å‘å¸ƒçš„ç¤ºä¾‹å®žé™…ä¸Šä¼šäº§ç”Ÿè¯­æ³•é”™è¯¯â€”â€”æ‚¨ä¸èƒ½è‡ªå·±ä½¿ç”¨é—®å·ã€‚æœªçŸ¥ç»´åº¦çš„åŽŸå› å½“ç„¶å¯ä»¥æ˜¯å…·æœ‰`[6, 1, 2]`ç»´åº¦çš„å ä½ç¬¦ï¼Œå¹¶ä¸”é€šå¸¸æ ¹æ®å ä½ç¬¦å®šä¹‰çš„å¼ é‡ï¼ˆå³åº”ç”¨äºŽå®ƒä»¬çš„æŸäº›è¿ç®—çš„ç»“æžœï¼‰ä¹Ÿå°†å…·æœ‰æœªçŸ¥ç»´åº¦ã€‚æ­¤å¤–ï¼Œæœ‰äº›æ“ä½œå¯èƒ½æ²¡æœ‰æŒ‡å®šï¼ˆéƒ¨åˆ†ï¼‰å®ƒä»¬çš„è¾“å‡ºå½¢çŠ¶ï¼Œè¿™ä¹Ÿå¯èƒ½å¯¼è‡´æœªçŸ¥ã€‚
è¿™é‡Œå¯èƒ½è¿˜æœ‰ä¸€äº›æˆ‘é—æ¼çš„æŠ€æœ¯ç»†èŠ‚ï¼Œä½†æ ¹æ®ç»éªŒï¼šä½¿ç”¨`None`ä½œä¸ºå ä½ç¬¦ï¼Œä½¿ç”¨`None`è¿›è¡Œæ•´å½¢ã€‚è¿™åº”è¯¥æ¶µç›–å¤§å¤šæ•°ç”¨ä¾‹ã€‚



> `ï¼Ÿ`== `None` ï¼Œç»´åº¦æ˜¯æœªçŸ¥çš„
>
> `-1`ä»£è¡¨æ ¹æ®æŽ¨æ–­ä¹‹åŽçš„ç»´åº¦
>
> `(3,)`  è¡¨æ˜Žå¼ é‡æ˜¯ä¸€ä¸ªä¸€ç»´æ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„çš„é•¿åº¦ä¸º3
>
> 



> [https://www.coder.work/article/2032326](https://www.coder.work/article/2032326)



### kerasçš„ call å‡½æ•°ã€build å‡½æ•°

build() ç”¨æ¥åˆå§‹åŒ–å®šä¹‰weights, è¿™é‡Œå¯ä»¥ç”¨çˆ¶ç±»çš„self.add_weight() å‡½æ•°æ¥åˆå§‹åŒ–æ•°æ®, è¯¥å‡½æ•°å¿…é¡»å°† self.built è®¾ç½®ä¸ºTrue, ä»¥ä¿è¯è¯¥ Layer å·²ç»æˆåŠŸ build , é€šå¸¸å¦‚ä¸Šæ‰€ç¤º, ä½¿ç”¨ super(MyLayer, self).build(input_shape) æ¥å®Œæˆã€‚

call() ç”¨æ¥æ‰§è¡Œ Layer çš„èŒèƒ½, xå°±æ˜¯è¯¥å±‚çš„è¾“å…¥ï¼Œxä¸Žæƒé‡kernelåšç‚¹ç§¯ï¼Œç”Ÿæˆæ–°çš„èŠ‚ç‚¹å±‚ï¼Œå³å½“å‰ Layer æ‰€æœ‰çš„è®¡ç®—è¿‡ç¨‹å‡åœ¨è¯¥å‡½æ•°ä¸­å®Œæˆã€‚



`__init__()`å’Œ`build()`å‡½æ•°éƒ½åœ¨å¯¹Layerè¿›è¡Œåˆå§‹åŒ–ï¼Œéƒ½åˆå§‹åŒ–äº†ä¸€äº›æˆå‘˜å‡½æ•°

`__init__()`ï¼šä¿å­˜æˆå‘˜å˜é‡çš„è®¾ç½®

`build()`ï¼šåœ¨`call()`å‡½æ•°ç¬¬ä¸€æ¬¡æ‰§è¡Œæ—¶ä¼šè¢«è°ƒç”¨ä¸€æ¬¡ï¼Œè¿™æ—¶å€™å¯ä»¥çŸ¥é“è¾“å…¥æ•°æ®çš„`shape`ã€‚è¿”å›žåŽ»çœ‹ä¸€çœ‹ï¼Œæžœç„¶æ˜¯`__init__()`å‡½æ•°ä¸­åªåˆå§‹åŒ–äº†è¾“å‡ºæ•°æ®çš„`shape`ï¼Œè€Œè¾“å…¥æ•°æ®çš„`shape`éœ€è¦åœ¨`build()`å‡½æ•°ä¸­åŠ¨æ€èŽ·å–ï¼Œè¿™ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆåœ¨æœ‰`__init__()`å‡½æ•°æ—¶è¿˜éœ€è¦ä½¿ç”¨`build()`å‡½æ•°



`call()`å‡½æ•°åˆ™æ˜¯åœ¨è¯¥layerè¢«è°ƒç”¨æ—¶æ‰§è¡Œã€‚ 



> [https://blog.csdn.net/qq_32623363/article/details/104128497](https://blog.csdn.net/qq_32623363/article/details/104128497)
>
> [https://blog.csdn.net/qq_27825451/article/details/90517036](https://blog.csdn.net/qq_27825451/article/details/90517036)



### tf.expand_dimsï¼ˆï¼‰

```python
tf.expand_dims(input, dim, name=None) #åœ¨æŒ‡å®šä½ç½®å¢žåŠ ç»´åº¦
```

> [https://blog.csdn.net/jasonzzj/article/details/60811035](https://blog.csdn.net/jasonzzj/article/details/60811035)



### tf.boolean_maskï¼ˆï¼‰

é€‰æ‹©å¼ é‡çš„ç‰¹å®šç»´åº¦çš„å€¼

```python
tf.boolean_mask(tensor,mask,name='boolean_mask',axis=None)

#1-D example
tensor = [0, 1, 2, 3]
mask = np.array([True, False, True, False])
boolean_mask(tensor, mask)  # [0, 2]

#2-D example
tensor = [[1, 2], [3, 4], [5, 6]]
mask = np.array([True, False, True])
boolean_mask(tensor, mask)  # [[1, 2], [5, 6]]
```

> [https://blog.csdn.net/wuguangbin1230/article/details/81334544](https://blog.csdn.net/wuguangbin1230/article/details/81334544)





## ðŸš€pytorch

### PyTorch  torch.nn.Parameter()

**ä½œç”¨**ï¼šå¯¹äºŽ`self.v = torch.nn.Parameter(torch.FloatTensor(hidden_size))`ï¼Œä¹Ÿå°±æ˜¯å°†ä¸€ä¸ªä¸å¯è®­ç»ƒçš„ç±»åž‹`Tensor`è½¬æ¢æˆå¯ä»¥è®­ç»ƒçš„ç±»åž‹`parameter`å¹¶å°†è¿™ä¸ª`parameter`ç»‘å®šåˆ°è¿™ä¸ª`module`é‡Œé¢(`net.parameter()`ä¸­å°±æœ‰è¿™ä¸ªç»‘å®šçš„`parameter`ï¼Œæ‰€ä»¥åœ¨å‚æ•°ä¼˜åŒ–çš„æ—¶å€™å¯ä»¥è¿›è¡Œä¼˜åŒ–çš„)ï¼Œæ‰€ä»¥ç»è¿‡ç±»åž‹è½¬æ¢è¿™ä¸ª`self.v`å˜æˆäº†æ¨¡åž‹çš„ä¸€éƒ¨åˆ†ï¼Œæˆä¸ºäº†æ¨¡åž‹ä¸­æ ¹æ®è®­ç»ƒå¯ä»¥æ”¹åŠ¨çš„å‚æ•°äº†ã€‚

ä½¿ç”¨è¿™ä¸ªå‡½æ•°çš„ç›®çš„ä¹Ÿæ˜¯æƒ³è®©æŸäº›å˜é‡åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­ä¸æ–­çš„ä¿®æ”¹å…¶å€¼ä»¥è¾¾åˆ°æœ€ä¼˜åŒ–ã€‚



> [https://www.jianshu.com/p/d8b77cc02410](https://www.jianshu.com/p/d8b77cc02410)



### PyTorch  nn.Linearï¼ˆï¼‰

ç”¨äºŽè®¾ç½®ç½‘ç»œä¸­çš„**å…¨è¿žæŽ¥å±‚çš„**

> [https://blog.csdn.net/qq_42079689/article/details/102873766](https://blog.csdn.net/qq_42079689/article/details/102873766)



### pytorch  nn.embedding() è¯å‘é‡

è¯åµŒå…¥åœ¨ pytorch ä¸­éžå¸¸ç®€å•ï¼Œåªéœ€è¦è°ƒç”¨ `torch.nn.Embedding(m, n)` å°±å¯ä»¥äº†ï¼Œm è¡¨ç¤ºå•è¯çš„æ€»æ•°ç›®ï¼Œn è¡¨ç¤ºè¯åµŒå…¥çš„ç»´åº¦ï¼Œå…¶å®žè¯åµŒå…¥å°±ç›¸å½“äºŽæ˜¯ä¸€ä¸ªå¤§çŸ©é˜µï¼ŒçŸ©é˜µçš„æ¯ä¸€è¡Œè¡¨ç¤ºä¸€ä¸ªå•è¯ã€‚

**éšæœºåˆå§‹åŒ–**

> [https://blog.csdn.net/david0611/article/details/81090371](https://blog.csdn.net/david0611/article/details/81090371)

### pytorch  torch.mean()

**torch.mean(input, dim, keepdim=False, out=None)**

è¿”å›žæ–°çš„å¼ é‡ï¼Œå…¶ä¸­åŒ…å«è¾“å…¥å¼ é‡inputæŒ‡å®šç»´åº¦dimä¸­æ¯è¡Œçš„å¹³å‡å€¼ã€‚

è‹¥keepdimå€¼ä¸ºTrueï¼Œåˆ™åœ¨è¾“å‡ºå¼ é‡ä¸­ï¼Œé™¤äº†è¢«æ“ä½œçš„dimç»´åº¦å€¼é™ä¸º1ï¼Œå…¶å®ƒç»´åº¦ä¸Žè¾“å…¥å¼ é‡inputç›¸åŒã€‚å¦åˆ™ï¼Œdimç»´åº¦ç›¸å½“äºŽè¢«æ‰§è¡Œtorch.squeeze()ç»´åº¦åŽ‹ç¼©æ“ä½œï¼Œå¯¼è‡´æ­¤ç»´åº¦æ¶ˆå¤±ï¼Œæœ€ç»ˆè¾“å‡ºå¼ é‡ä¼šæ¯”è¾“å…¥å¼ é‡å°‘ä¸€ä¸ªç»´åº¦ã€‚

**å‚æ•°ï¼š**

- input (Tensor) - è¾“å…¥å¼ é‡
- dim (int) - æŒ‡å®šè¿›è¡Œå‡å€¼è®¡ç®—çš„ç»´åº¦
- keepdim (bool, optional) - è¾“å‡ºå¼ é‡æ˜¯å¦ä¿æŒä¸Žè¾“å…¥å¼ é‡æœ‰ç›¸åŒæ•°é‡çš„ç»´åº¦
- out (Tensor) - ç»“æžœå¼ é‡

**ä¾‹å­ï¼š**

> a = torch.randn(4, 5)
> a
> 0.3168 0.4953 -0.6758 -0.5559 -0.6906
> 0.2241 2.2450 1.5735 -1.3815 -1.5199
> 0.0033 0.5236 -0.9070 -0.5961 -2.1281
> 0.9605 1.5314 -0.6555 -1.2584 -0.4160
> [torch.FloatTensor of size 4x5]
> torch.mean(a, 1, True)
> -0.2220
> 0.2283
> -0.6209
> 0.0324
> [torch.FloatTensor of size 4x1]



### np.triu() & np.tril()

```python
def triuï¼ˆmï¼Œ kï¼‰ï¼š
#å–ä¸Šä¸‰è§’é˜µ  
#mï¼šè¡¨ç¤ºä¸€ä¸ªçŸ©é˜µ
#Kï¼šè¡¨ç¤ºå¯¹è§’çº¿çš„èµ·å§‹ä½ç½®ï¼ˆkå–å€¼é»˜è®¤ä¸º0ï¼‰

#k=0è¡¨ç¤ºæ­£å¸¸çš„ä¸Šä¸‰è§’çŸ©é˜µ
#k=-1è¡¨ç¤ºå¯¹è§’çº¿çš„ä½ç½®ä¸‹ç§»1ä¸ªå¯¹è§’çº¿
#k=1è¡¨ç¤ºå¯¹è§’çº¿çš„ä½ç½®ä¸Šç§»1ä¸ªå¯¹è§’çº¿

#åŒç†ï¼Œnp.trilå–ä¸‹ä¸‰è§’é˜µ  
```

> [https://blog.csdn.net/weixin_37724529/article/details/102881776](https://blog.csdn.net/weixin_37724529/article/details/102881776)



###  pytorch  forwardçš„ä½¿ç”¨ä»¥åŠåŽŸç†   --pytorchä½¿ç”¨

> [https://blog.csdn.net/u011501388/article/details/84062483](https://blog.csdn.net/u011501388/article/details/84062483)



### PyTorch  torch.nn.Parameter()è¯¦è§£

> [https://cloud.tencent.com/developer/article/1608348](https://cloud.tencent.com/developer/article/1608348)



### pytorch  view()

PyTorchä¸­**view**å‡½æ•°ä½œç”¨ä¸ºé‡æž„å¼ é‡çš„ç»´åº¦

> torch.view(å‚æ•°a,å‚æ•°b,.....)ï¼Œå…¶ä¸­å‚æ•°a=3,å‚æ•°b=2å†³å®šäº†å°†ä¸€ç»´çš„tt1é‡æž„æˆ3*2ç»´çš„å¼ é‡ã€‚
>  æœ‰æ—¶å€™ä¼šå‡ºçŽ°torch.view(-1)æˆ–è€…torch.view(å‚æ•°a,-1)è¿™ç§æƒ…å†µã€‚åˆ™-1å‚æ•°æ˜¯éœ€è¦ä¼°ç®—çš„ã€‚

```python
import torch
tt3=torch.tensor([[-0.3623,-0.6115],[0.7283,0.4699],[2.3261,0.1599]])
result2=tt3.view(2,-1).contiguous()
```

åˆ™`result2`ä¸º

```css
tensor([[-0.3623, -0.6115,  0.7283],
        [ 0.4699,  2.3261,  0.1599]])
```



### pytorch  model.parameters()

è¿™ä¸ªæ–¹æ³•ä¼šèŽ·å¾—æ¨¡åž‹çš„å‚æ•°ä¿¡æ¯ ã€‚ 

model.parameters()æ–¹æ³•**è¿”å›žçš„æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨generatorï¼Œæ¯ä¸€ä¸ªå…ƒç´ æ˜¯ä»Žå¼€å¤´åˆ°ç»“å°¾çš„å‚æ•°**ï¼Œparametersæ²¡æœ‰å¯¹åº”çš„keyåç§°ï¼Œæ˜¯ä¸€ä¸ªç”±çº¯å‚æ•°ç»„æˆçš„generatorï¼ŒæŸ¥çœ‹Moduleçš„å‚æ•°ä¿¡æ¯ï¼Œ**ç”¨äºŽæ›´æ–°å‚æ•°ï¼Œæˆ–è€…ç”¨äºŽæ¨¡åž‹çš„ä¿å­˜ã€‚**



> [https://blog.csdn.net/qq_27825451/article/details/95888267](https://blog.csdn.net/qq_27825451/article/details/95888267)



### pytorch  torch.optim.lr_scheduler

ç”¨äºŽè®¾ç½®å­¦ä¹ çŽ‡çš„è¡°å‡

> [https://zhuanlan.zhihu.com/p/69411064](https://zhuanlan.zhihu.com/p/69411064)



### pytorch  torch.gatherï¼ˆï¼‰

ä¾‹å­

```python
b = torch.Tensor([[1,2,3],[4,5,6]])
print b
index_1 = torch.LongTensor([[0,1],[2,0]])
index_2 = torch.LongTensor([[0,1,1],[0,0,0]])
print torch.gather(b, dim=1, index=index_1)
print torch.gather(b, dim=0, index=index_2)

```

è§‚å¯Ÿå®ƒçš„è¾“å‡ºç»“æžœï¼š

```
 1  2  3
 4  5  6
[torch.FloatTensor of size 2x3]


 1  2
 6  4
[torch.FloatTensor of size 2x2]


 1  5  6
 1  2  3
[torch.FloatTensor of size 2x3]


```

è¿™é‡Œæ˜¯å®˜æ–¹æ–‡æ¡£çš„è§£é‡Š

```
torch.gather(input, dim, index, out=None) â†’ Tensor

    Gathers values along an axis specified by dim.

    For a 3-D tensor the output is specified by:

    out[i][j][k] = input[index[i][j][k]][j][k]  # dim=0
    out[i][j][k] = input[i][index[i][j][k]][k]  # dim=1
    out[i][j][k] = input[i][j][index[i][j][k]]  # dim=2

    Parameters:	

        input (Tensor) â€“ The source tensor
        dim (int) â€“ The axis along which to index
        index (LongTensor) â€“ The indices of elements to gather
        out (Tensor, optional) â€“ Destination tensor

    Example:

    >>> t = torch.Tensor([[1,2],[3,4]])
    >>> torch.gather(t, 1, torch.LongTensor([[0,0],[1,0]]))
     1  1
     4  3
    [torch.FloatTensor of size 2x2]

```

 :star: å¯ä»¥çœ‹å‡ºï¼Œgatherçš„ä½œç”¨æ˜¯è¿™æ ·çš„ï¼Œindexå®žé™…ä¸Šæ˜¯ç´¢å¼•ï¼Œå…·ä½“æ˜¯è¡Œè¿˜æ˜¯åˆ—çš„ç´¢å¼•è¦çœ‹å‰é¢dim çš„æŒ‡å®šï¼Œæ¯”å¦‚å¯¹äºŽæˆ‘ä»¬çš„æ —å­ï¼Œã€1,2,3;4,5,6,ã€‘ï¼ŒæŒ‡å®šdim=1ï¼Œä¹Ÿå°±æ˜¯æ¨ªå‘ï¼Œé‚£ä¹ˆç´¢å¼•å°±æ˜¯åˆ—å·ã€‚indexçš„å¤§å°å°±æ˜¯è¾“å‡ºçš„å¤§å°ï¼Œæ‰€ä»¥æ¯”å¦‚indexæ˜¯ã€1,0;0,0ã€‘ï¼Œé‚£ä¹ˆçœ‹indexç¬¬ä¸€è¡Œï¼Œ1åˆ—æŒ‡çš„æ˜¯2ï¼Œ 0åˆ—æŒ‡çš„æ˜¯1ï¼ŒåŒç†ï¼Œç¬¬äºŒè¡Œä¸º4ï¼Œ4 ã€‚è¿™æ ·å°±è¾“å…¥ä¸ºã€2,1;4,4ã€‘ï¼Œå‚è€ƒè¿™æ ·çš„è§£é‡Šçœ‹ä¸Šé¢çš„è¾“å‡ºç»“æžœï¼Œå³å¯ç†è§£gatherçš„å«ä¹‰ã€‚

gatheråœ¨one-hotä¸ºè¾“å‡ºçš„å¤šåˆ†ç±»é—®é¢˜ä¸­ï¼Œå¯ä»¥æŠŠæœ€å¤§å€¼åæ ‡ä½œä¸ºindexä¼ è¿›åŽ»ï¼Œç„¶åŽæå–åˆ°æ¯ä¸€è¡Œçš„æ­£ç¡®é¢„æµ‹ç»“æžœï¼Œè¿™ä¹Ÿæ˜¯gatherå¯èƒ½çš„ä¸€ä¸ªä½œç”¨ã€‚

> [https://blog.csdn.net/edogawachia/article/details/80515038](https://blog.csdn.net/edogawachia/article/details/80515038)
>
> [https://www.cnblogs.com/HongjianChen/p/9451526.html](https://www.cnblogs.com/HongjianChen/p/9451526.html)



### pytorch  æŸå¤±å‡½æ•°NLLLosså’ŒCrossEntropyLoss ()



> [https://blog.csdn.net/qq_22210253/article/details/85229988](https://blog.csdn.net/qq_22210253/article/details/85229988)
>
> [https://zhuanlan.zhihu.com/p/98785902](https://zhuanlan.zhihu.com/p/98785902)



### pytorch enisumå‡½æ•° 

> [https://www.cnblogs.com/mengnan/p/10319701.html](https://www.cnblogs.com/mengnan/p/10319701.html)

